app-www:
  host: "mano-app.fabrique.social.gouv.fr"
  certSecretName: www-crt
  ingress:
    annotations:
      nginx.ingress.kubernetes.io/configuration-snippet: |
        more_set_headers "Content-Security-Policy: default-src 'none'; connect-src 'self' https://*.gouv.fr; font-src 'self'; img-src 'self'; prefetch-src 'self' https://*.gouv.fr; script-src 'self' https://*.gouv.fr; frame-src 'self' https://*.gouv.fr; style-src 'self' 'unsafe-inline'";
        more_set_headers "X-Frame-Options: deny";
        more_set_headers "X-XSS-Protection: 1; mode=block";
        more_set_headers "X-Content-Type-Options: nosniff";

app-api:
  host: "mano.fabrique.social.gouv.fr"
  certSecretName: api-crt
  addVolumes:
    - files
  envFrom:
    - secretRef:
        name: api
    - configMapRef:
        name: api
    - secretRef:
        name: azure-mano-volume
    - secretRef:
        name: "{{ .Values.global.pgSecretName }}"

app-dashboard:
  host: "dashboard-mano.fabrique.social.gouv.fr"
  certSecretName: dashboard-crt

metabase:
  enabled: true
  ingress:
    enabled: false
  envFrom:
    - configMapRef:
        name: metabase-configmap
    - secretRef:
        name: metabase-db-user

oauth2-proxy:
  host: "metabase-mano.fabrique.social.gouv.fr"
  certSecretName: oauth2-proxy-crt
  enabled: true
  upstream: http://metabase
  envFrom:
    - configMapRef:
        name: oauth2-proxy-configmap
    - secretRef:
        name: oauth2-proxy-sealed-secret
  additionalArgs:
    - --skip-auth-route
    - ^/public/.*,^/app/dist/.*,^/api/public/.*,^/api/session/.*,^/app/assets/.*
