/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-fetch",
factory: function (require) {
var plugin=(()=>{var ie=Object.defineProperty;var le=(n,t,e)=>t in n?ie(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});var i=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var f=(n,t,e)=>(le(n,typeof t!="symbol"?t+"":t,e),e);var w=i((_e,A)=>{"use strict";A.exports=function(t){return t.map(function(e){return e&&typeof e=="object"?e.op.replace(/(.)/g,"\\$1"):/["\s]/.test(e)&&!/'/.test(e)?"'"+e.replace(/(['\\])/g,"\\$1")+"'":/["'\s]/.test(e)?'"'+e.replace(/(["\\$`!])/g,"\\$1")+'"':String(e).replace(/([A-Za-z]:)?([#!"$&'()*,:;<=>?@[\\\]^`{|}])/g,"$1\\$2")}).join(" ")}});var v=i((ze,Y)=>{var C=c("fs"),ue=c("path"),{parseSyml:pe}=c("@yarnpkg/parsers"),B=["patch","npm","portal","link"];Y.exports=function(){let t=C.readFileSync("yarn.lock","utf8"),e=pe(t),r=Object.keys(e).filter(o=>o.includes("@workspace:")),s=r.map(o=>{let[,l]=e[o].resolution.trim().split("@workspace:");return l==="."?null:l}).filter(Boolean);r.forEach(o=>{let{dependencies:l,dependenciesMeta:u,peerDependencies:b,peerDependenciesMeta:P,resolution:D,bin:oe}=e[o],[ce,$]=D.trim().split("@workspace:"),ae=ue.join($,"package.json"),x={name:ce,version:"0.0.0",description:"**DON'T COMMIT** Generated file for caching",private:!0,dependencies:l,peerDependencies:b,peerDependenciesMeta:P,bin:oe};if(u){let g={};Object.keys(u).forEach(m=>{g[m]=l[m],delete l[m]}),x.optionalDependencies=g}if($==="."){s.length>0&&(x.workspaces={packages:s});let g=Object.keys(e),m=a=>{let p=a.trim().split("@");return a.startsWith("@")?p=p.slice(0,2):p=p.slice(0,1),p.join("@")};x.resolutions=g.filter(a=>{if(a.includes("@workspace:")||a.includes(", ")||!B.some(k=>a.includes(`@${k}:`)))return!1;let p=m(a);return a.includes("@patch:")||g.every(k=>a===k?!0:k.split(",").every(h=>h.includes("@patch:")?!0:m(h)!==p))}).reduce((a,p)=>(B.forEach(k=>{if(!p.includes(`@${k}:`))return;let[h,y]=p.trim().split(`@${k}:`);switch(k){case"npm":a[h]=y.includes("@")?`${k}:${y}`:y;break;case"patch":p.includes("builtin<compat/")||(a[h]=`${k}:${y.split("::")[0]}`);break;case"portal":case"link":a[h]=`${k}:${y.split("::")[0]}`;break}}),a),{})}C.mkdirSync($,{recursive:!0}),C.writeFileSync(ae,`${JSON.stringify(x,null,2)}
`)})}});var j=i((Ge,H)=>{var ke=v();H.exports=n=>{n.context.stdout.write(`[YARN-FETCH] extracting package.json file(s) from yarn.lock
`),ke()}});var M=i((Ze,L)=>{var d=c("fs"),fe=c("path"),{execSync:de}=c("child_process"),{parseSyml:me}=c("@yarnpkg/parsers"),{BaseCommand:he}=c("@yarnpkg/cli"),{Command:ge,Option:R}=c("clipanion"),ye=w(),xe=j(),q;L.exports=(q=class extends he{protectPackageJson=R.Boolean("--protect-package-json");args=R.Proxy();async execute(){let{protectPackageJson:t=process.stdout.isTTY}=this,e=[];if(t){this.context.stdout.write(`[YARN-FETCH] backup possible package.json file(s)
`);let s=d.readFileSync("yarn.lock","utf8"),o=me(s);e=Object.keys(o).filter(u=>u.includes("@workspace:")).map(u=>{let{resolution:b}=o[u],[,P]=b.trim().split("@workspace:");return fe.join(P,"package.json")}),e.forEach(u=>{d.existsSync(u)&&!d.existsSync(`${u}.yarn-plugin-fetch-bak`)&&d.copyFileSync(u,`${u}.yarn-plugin-fetch-bak`)})}xe(this);let r=`yarn ${ye(this.args)}`;this.context.stdout.write(`[YARN-FETCH] ${r}
`);try{de(r,{stdio:"inherit"})}catch(s){throw s}finally{t&&(this.context.stdout.write(`[YARN-FETCH] restoring possible package.json file(s)
`),e.forEach(s=>{d.existsSync(`${s}.yarn-plugin-fetch-bak`)?d.renameSync(`${s}.yarn-plugin-fetch-bak`,s):d.unlinkSync(s)}))}}},f(q,"paths",[["fetch"]]),f(q,"usage",ge.Usage({description:"fetch dependencies from yarn.lock in Docker build",details:`
      expand yarn.lock to package.json file(s) and install dependencies in Docker build.
    `,examples:[["yarn fetch --immutable","yarn fetch workspace my-package focus"]]})),q)});var K=i((Xe,I)=>{var{BaseCommand:qe}=c("@yarnpkg/cli"),be=j(),S;I.exports=(S=class extends qe{async execute(){be(this)}},f(S,"paths",[["fetch-tools","expand-lock"]]),S)});var _=i((tt,W)=>{function Pe(n,t,e){let r=t.split("."),s=n;for(let o of r){if(s[o]===void 0)return e;s=s[o]}return s}function $e(n,t,e){let r=t.split("."),s=n;for(let o=0;o<r.length-1;o++){let l=r[o];(!s[l]||typeof s[l]!="object")&&(s[l]={}),s=s[l]}return s[r[r.length-1]]=e,n}function we(n,t){let e=t.split("."),r=n;for(let s=0;s<e.length-1;s++){let o=e[s];if(!r[o])return!1;r=r[o]}return delete r[e[e.length-1]],!0}W.exports={get:Pe,set:$e,unset:we}});var F=i((st,G)=>{var z=c("fs"),{get:Ce,set:je,unset:Se}=_();G.exports=function(t,e){let r=JSON.parse(z.readFileSync("package.json","utf-8")),s=Ce(r,t);s!==void 0&&(je(r,e,s),Se(r,t),z.writeFileSync("package.json",JSON.stringify(r,null,2)))}});var E=i((nt,U)=>{var Fe=F();U.exports=function(){Fe("scripts._postinstall","scripts.postinstall")}});var Q=i((ot,Z)=>{var{BaseCommand:Ee}=c("@yarnpkg/cli"),Je=E(),J;Z.exports=(J=class extends Ee{async execute(){Je()}},f(J,"paths",[["fetch-tools","disable-postinstall"]]),J)});var N=i((at,V)=>{var Ne=F();V.exports=function(){Ne("scripts.postinstall","scripts._postinstall")}});var ee=i((lt,X)=>{var{BaseCommand:Te}=c("@yarnpkg/cli"),Oe=N(),T;X.exports=(T=class extends Te{async execute(){Oe()}},f(T,"paths",[["fetch-tools","disable-postinstall"]]),T)});var ne=i((kt,se)=>{var{execSync:De}=c("child_process"),{BaseCommand:Ae}=c("@yarnpkg/cli"),{Option:te}=c("clipanion"),Be=w(),Ye=E(),ve=N(),O;se.exports=(O=class extends Ae{postinstall=te.Boolean("--postinstall");args=te.Proxy();async execute(){this.postinstall||(this.context.stdout.write(`[YARN-FETCH] disable postinstall command in package.json
`),ve());let t=`yarn workspaces focus --production ${Be(this.args)}`;this.context.stdout.write(`[YARN-FETCH] ${t}
`),De(t,{stdio:"inherit"}),this.postinstall||(this.context.stdout.write(`[YARN-FETCH] re-enable postinstall command in package.json
`),Ye())}},f(O,"paths",[["fetch-tools","production"]]),O)});var Ke=i((dt,re)=>{var He=M(),Re=K(),Le=Q(),Me=ee(),Ie=ne();re.exports={commands:[He,Re,Me,Le,Ie]}});return Ke();})();
return plugin;
}
};
