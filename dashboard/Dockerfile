FROM node:20

ARG REACT_APP_SCHEME
ARG REACT_APP_HOST
ARG REACT_APP_USE_HTTP

ENV REACT_APP_SCHEME $REACT_APP_SCHEME
ENV REACT_APP_HOST $REACT_APP_HOST
ENV REACT_APP_USE_HTTP $REACT_APP_USE_HTTP
ENV NEXT_TELEMETRY_DISABLED 1
ENV APP_ENV production

WORKDIR /usr/src/app
COPY yarn.lock .yarnrc.yml ./
COPY .yarn .yarn
RUN yarn fetch --immutable

COPY . .

RUN yarn build
EXPOSE 8083
CMD ["yarn", "start"]
