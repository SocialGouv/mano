// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`kosko generate --prod 1`] = `
"---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    app: api
    application: mano
    component: mano
    owner: mano
    team: mano
  name: api
  namespace: mano
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api
  template:
    metadata:
      annotations:
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        kapp.k14s.io/delete-strategy: orphan
        app.gitlab.com/app: socialgouv-mano
        app.gitlab.com/env: prod
        app.gitlab.com/env.name: prod
      labels:
        app: api
        application: mano
        component: mano
        owner: mano
        team: mano
    spec:
      containers:
        - image: ghcr.io/socialgouv/mano/api:sha-undefined
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 5
          name: api
          ports:
            - containerPort: 3000
              name: http
          readinessProbe:
            failureThreshold: 15
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 0
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              cpu: '1'
              memory: 1Gi
            requests:
              cpu: 250m
              memory: 256Mi
          startupProbe:
            failureThreshold: 12
            httpGet:
              path: /healthz
              port: http
            periodSeconds: 5
          volumeMounts:
            - mountPath: /mnt/files
              name: files
          envFrom:
            - secretRef:
                name: azure-pg-user
            - secretRef:
                name: api
            - configMapRef:
                name: api-configmap
          env:
            - name: STORAGE_DIRECTORY
              value: /mnt/files
      imagePullSecrets:
        - name: regcred
      volumes:
        - name: files
          persistentVolumeClaim:
            claimName: files
      initContainers:
        - env:
            - name: WAIT_FOR_RETRIES
              value: '24'
          envFrom:
            - secretRef:
                name: azure-pg-user
          image: ghcr.io/socialgouv/docker/wait-for-postgres:6.56.1
          imagePullPolicy: Always
          name: wait-for-postgres
          resources:
            limits:
              cpu: 20m
              memory: 32Mi
            requests:
              cpu: 5m
              memory: 16Mi
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  name: api
  namespace: mano
  labels:
    application: mano
    component: mano
    owner: mano
    team: mano
spec:
  encryptedData:
    X_TIPIMAIL_APIUSER: >-
      AgBVs+HJnZoyliAsiJo6vF43mbTC6/4nI+/25WIZLH3Z9N2GaqzgCK9frniVfYrfINdqKoXaiqgdw+PocyPhPVMOw9AHWveTkfZ34lOXsa37EIqePrj90kEnhPP9LxO/pI98Bj9/df7wi7hLJY0wFm/ys6VG6In1LTBWsaGdIHyUVBRuuQmHCgUG3s9hKLqAKNfGfcFMOGFwNQMcZZ8wK2ZJhunlkjohJExyzR1v7KYLkbFTUrnvCHVLEwJ/MQQruYCcYfL8DxbuPL+hie/A8a9ELB8BmdFVdxjBXmAZ4iHRY5b9jqRBrMzUVc0oHE03k1qjDNrlRTxV4AcAL5AduKWjwpz4iCEY5tqOKMapq/8sHRnKUYzZnFJdD76AFObL1MSzoTvy2JOjKQ5/4o4TK3LxQ5V7qFLZTKv5ipTicwhIwdgUYtda+l+Z8gdoCQl5COgpppgfw/EOF4Pd/WGvlK2B7GI5EpzpozDL+5ASlvROO48iRgHTSfPfxAVxw+7QNJhP4GSts1ODPC+XLa3LJ37Knca/sC3/cIZKi0uXSwQlBNPIZ4vMfS4dRRjchfcDUoVxv7pkhBsZ6OM8qqBVG2yjChf2uW7DzvOnzDr/kB3q/xznHCL5XOISfE7M7ua4QgWFFwu+QM0seMJAZH/wzhmBhjnzZYSktnc5KZ3TgIiHuNiTo81CP00Rf1afcP5EuMtSHnAiBpalX/ANP5Jw7KHtdJ8uhiRwfjrSLJxi/eJCwQ==
    X_TIPIMAIL_APIKEY: >-
      AgAODYMp5mGFfXDRKEVr48Mp5J1tDSh/iBYK/INwGcPyesG4zpnSIi74PCbj7LB4+A9LotaFfin5Rl4RPcmww8aEPa/plKs+1qc0EWJ3uMtifMf4rPbLhsbzbdIxiC+/cA+WA378tuM8eb7B5y1Xram3Kf4P/S20P0Dc3bSb/vO2Zv/xVZwFwmo96j+a8DNbSUtN17F7tbbJwQbHS7z16kTH3ZwVusG+N2rG93E4TrjyARtDS8qIz9pX2wr+zp9PIsDSAXZbauV6PaSbKkGUAyt6YLaCvnKXZffZxcPMhzy9XBwWw5oKeCadwVa9W7OVbah7QAKyzR2KFptcU/QAVIYiDZuFCNQL7llD0MJTPgpPFbUyyXc4x76eFuCErq9t+acTQ86jJyMNjkR8EROtxPGwpTbqEeLB0VH7e5RixvJgoamyQQCcSQHKtv7zI72yYUtba57+eQiWGWb+MJ1h9/ZXm0zw3XUEgqbzcBWBnrr308I6KXiUgLDRFsN4TtS8ecfmJewwxK/JBrQvx8LDRS6+UPqQlrqo2hwG40LVd1U0hGnCbA/6r+3Jj5g9wCWPUEBkslmjOjgOxcwVDwct9uu/PrRsAazoBDRcvbO4AEsQW+rcoxTRZYncW00dKvCmoTD+fqKstWWrA2wSi3RG1w20jIU/cPf32rE3LGWQwrIYNEfgEkANp/vbtk7BlMKR5oUfahDo9VAMhEDOismUBsj5q/8MApPWUhncre3VzweAMg==
    SECRET: >-
      AgBXhk1jaMUTyQVnpPF7ljm8FtEq4yKjG47LmCl48gQ8Kq/V6RLoH1XFTirSGfzyo/WD18wd8+CyxlYGVIEjRSOEHzdF0cFxOZDoqbj8fmYTgcoIJ+eUflbJjdMk12rDtHDUHKk2tLWGPB3/sB9oG5Ztp+eMCUB5OOCx8k9CcA3b6JkdIMdQ5Z/bHDG5BDc0SfTAsIuEYwiAJtqnV4XQmCh4PKU9Ka1PEIMDs0vsFboCeys0MdJf+RLs55NkaQfXTsIOUFnjC6ARMMLuF8ZhvHXlHaS7qZ4MdvIHXr8fMIXRCOTUCdWFwo3kgJQZkSe0l70QbXizO66u3woQzlV9CMn15EQtCgHWxh62c4+gyM78QHG4rrTUrMNui4yKL4BJyTVuTKNw2Tdm4MPYuO0GAbORSaDoVtz79z0Uj3SkwUbE+9Eb8cf++jMcT9WNZ4y7MXoX5SRgz2Qpio3aMEkUSoD1ahURA23RSnu4c445BFw0SKN7Ozawy3mSJnB9suzT44jUjHhgLveXv5Ar8GQeBsXo79xK6w656TO2n01qQws2eGHKeFzOfQkm4gFHUjnGC2aB5e1SvcS08x7VchCn0LRUcMGM+hQG18y8kUmNc9ilcPT7H5USJy2UEfZbGgyGoJbIKhsiytVt56Mf3X/q2PlMUJ9dVLP5Nh0i60OZQ1X05pUNOhqAhQ3CnQe9J5i8TsQCCaY65W5xzSk51M6gC6GOer8Net9dC0tL/SVAS6J5Z26r6Q==
  template:
    metadata:
      annotations:
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        kapp.k14s.io/delete-strategy: orphan
        app.gitlab.com/app: socialgouv-mano
        app.gitlab.com/env: prod
        app.gitlab.com/env.name: prod
      name: api
      labels:
        application: mano
        component: mano
        owner: mano
        team: mano
    type: Opaque
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: api-configmap
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    application: mano
    component: mano
    owner: mano
    team: mano
  namespace: mano
data:
  MANO_API_IS_PRODUCTION: 'true'
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: api
    application: mano
    component: mano
    owner: mano
    team: mano
  name: api
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  namespace: mano
spec:
  ports:
    - name: http
      port: 80
      targetPort: 3000
  selector:
    app: api
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: 'true'
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    app: api
    application: mano
    component: mano
    owner: mano
    team: mano
  name: api
  namespace: mano
spec:
  rules:
    - host: mano.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              service:
                name: api
                port:
                  name: http
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - mano.fabrique.social.gouv.fr
      secretName: api-crt
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: files
  annotations:
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    application: mano
    component: mano
    owner: mano
    team: mano
  namespace: mano
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 20Gi
  selector:
    matchLabels:
      usage: prod-files
  storageClassName: ''
---
apiVersion: v1
kind: PersistentVolume
metadata:
  labels:
    usage: prod-files
    application: mano
    component: mano
    owner: mano
    team: mano
  name: prod-files
  annotations:
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  namespace: mano
spec:
  accessModes:
    - ReadWriteMany
  azureFile:
    secretName: azure-mano-volume
    secretNamespace: mano
    shareName: files
  capacity:
    storage: 20Gi
  persistentVolumeReclaimPolicy: Delete
  storageClassName: ''
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  annotations: {}
  name: azure-mano-volume
  namespace: mano
spec:
  encryptedData:
    azurestorageaccountkey: >-
      AgAod6AnLsMJ5wwXOYDuf+kltMiPGnM/akYbNk6vrX3ELMyQ2Q2d1Ewf4aGUwMEwMKfLwOX8+zbKPDzDnLkuuVWyLho1agpx1dGl3BxTns+NLXaUZtK9lSVjUp61RRFZduATbD+6ilOfYn07l222olnBba65L1tJFM1O4rbNGCSer2zJ72DfLy33nglVf0hNlv3d9LvkqpTKvMHP752+wCQ21Zg0qyCA/Kfy0oOimYS03V73ihckktYL698U5IhKwDDyevK5lGpoyrd5MrcHGXgCq06x0y3MqAMLa1cv6gOef0imnEUEHK4BrCu/FpirrFPq9p4ebQ9XpxLzucTeTkvASt2pLi2nCOc3UMk/IZigQPO1GfSWzacM/JqusysULXxbovLWdnSsFM5n8FrpUBnakWVRwA/QDTiqnOub768mkNYGCgEpRJ1lo1XBmS3ksqv+LDJVzi5ICbtYvam3S26y/BMrZi9pDoyl2mEkNzUUWpB4PiT5BVVDSDyOdo3AUuJFQITMChvHjuOlzA11SF4dfaKTF4//pjB+T+vHRSGEIZXO12DHs7B9QqwL9aiMkpX1usQ3F40R3x8oJZppCmDJGqbGUSN9pzu/nIF50YYR3WlqBT2uKmAp4DjKSQaFboFDfQcTgsPvusPM2pGFWlXylmBC4v05+JydyHMO/QEHClVRUrUcNV9zKWkieYV7MilyX3GhyKtWwE6KoOID7ZdPIYRIvNz/SBkxO/sfeDh3GM9Sb4oGZo157f00MGa0s5gSOqs27EUpfctIEtfi4RE70LZ61QZ3bCzmVT8/+nxaDrbV9VuSkJo0
    azurestorageaccountname: >-
      AgCH08uaRaYAKXsgLMDxrmE7I9QpOeKeUj2K8WzM4hOW4M4VUl5NSNM1kgylw50Zspr0yjO4BTaOHIHRew9Y99DjJg0CMmo/VvKr/c4zy3GJJw/FvtwXSvoe3tY9fjsDpcwFiASUUlT6D+0dFL/Maq9hGK5nFOO/xGLCBkQAQatVHOZ3oJaYpZiJH352GjA8utMo6vzh4XHyaCqbK5GGqYw6tvpmZnuAgU8IKZqUTf2WVTpzfziBCMPYZqmw4yb+jr8IKAhHLfghLpyYocGX7fTn1A/zDvzAhPrgl/jdXDE6+xT4bDH4ZWrvws6KBLqaep+uL7KfCL4dnuR+dQ0lQpY1WELHsp/+fjyG1/2l5iHPWv6cswEsOeETQnrvkASd1xrGdzBqTBb+zpeOyMQtx/i7F2uI3DHvptIRrs+VVr5HMzj+cIqP4CHeRbu3n+eU+jMkCipYQ0WzrIJbUoii6lusIl/RsFZlW3Qmsg/DGPX5Tq/G2D7IFs/xf8+e/X7k9ReUq59DCY2sgJ59Zf5jdYEthDeC0qwDJQsMt7u9wOKQkWAfum5/3Xnkro/n9YbT7/oFNrKzyian5eYunTz04CxzH7r8G58GkVuI9CzsuX5P3C69mJqhjZt1qHG7gGP5fL/D/Mdqpo30bMXHOJsTSpFZUuWAIwulqNLVuTkdHbRfqdqIEEbPFMynfkI5ZzGmIkzWrUddoepTvlYqSQ==
  template:
    metadata:
      annotations: {}
      name: azure-mano-volume
    type: Opaque
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    app: dashboard
    application: mano
    component: mano
    owner: mano
    team: mano
  name: dashboard
  namespace: mano
spec:
  replicas: 1
  selector:
    matchLabels:
      app: dashboard
  template:
    metadata:
      annotations:
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        kapp.k14s.io/delete-strategy: orphan
        app.gitlab.com/app: socialgouv-mano
        app.gitlab.com/env: prod
        app.gitlab.com/env.name: prod
      labels:
        app: dashboard
        application: mano
        component: mano
        owner: mano
        team: mano
    spec:
      containers:
        - image: ghcr.io/socialgouv/mano/dashboard:sha-undefined
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 5
          name: dashboard
          ports:
            - containerPort: 80
              name: http
          readinessProbe:
            failureThreshold: 15
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 0
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              cpu: 500m
              memory: 256Mi
            requests:
              cpu: 100m
              memory: 128Mi
          startupProbe:
            failureThreshold: 12
            httpGet:
              path: /healthz
              port: http
            periodSeconds: 5
            initialDelaySeconds: 30
      imagePullSecrets:
        - name: regcred
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: dashboard
    application: mano
    component: mano
    owner: mano
    team: mano
  name: dashboard
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  namespace: mano
spec:
  ports:
    - name: http
      port: 80
      targetPort: 80
  selector:
    app: dashboard
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: 'true'
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    app: dashboard
    application: mano
    component: mano
    owner: mano
    team: mano
  name: dashboard
  namespace: mano
spec:
  rules:
    - host: dashboard-mano.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              service:
                name: dashboard
                port:
                  name: http
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - dashboard-mano.fabrique.social.gouv.fr
      secretName: dashboard-crt
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    app: metabase
    application: mano
    component: mano
    owner: mano
    team: mano
  name: metabase
  namespace: mano
spec:
  replicas: 1
  selector:
    matchLabels:
      app: metabase
  template:
    metadata:
      annotations:
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        kapp.k14s.io/delete-strategy: orphan
        app.gitlab.com/app: socialgouv-mano
        app.gitlab.com/env: prod
        app.gitlab.com/env.name: prod
      labels:
        app: metabase
        application: mano
        component: mano
        owner: mano
        team: mano
    spec:
      containers:
        - image: metabase/metabase:v0.41.6
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /api/health
              port: http
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 5
          name: metabase
          ports:
            - containerPort: 3000
              name: http
          readinessProbe:
            failureThreshold: 15
            httpGet:
              path: /api/health
              port: http
            initialDelaySeconds: 0
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              cpu: 1000m
              memory: 2048Mi
            requests:
              cpu: 500m
              memory: 512Mi
          startupProbe:
            failureThreshold: 12
            httpGet:
              path: /api/health
              port: http
            periodSeconds: 10
            initialDelaySeconds: 240
            successThreshold: 1
            timeoutSeconds: 10
          envFrom:
            - secretRef:
                name: metabase-db-user
            - configMapRef:
                name: metabase-configmap
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  name: metabase-db-user
  namespace: mano
  labels:
    application: mano
    component: mano
    owner: mano
    team: mano
spec:
  encryptedData:
    MB_DB_CONNECTION_URI: >-
      AgAzyBTOcvPc6KVLVo+htqRVg+drrU1kom1remKacZcjinaiUhItYx3BELV0tZe82H7RVNsb9xa+F9hDx4P5FkcfVMMcxklCIXFZJrX7HafYiybZp8zw70I8Z1x6vNdwW9qkDxyNLK6k0P0S3UDZtSuh6kMiBG3mRAZANklTL8SAS8uU5h57q5aNt57edX/4yP/nej6zlOAZhffJmafdYBeVoW00IRyDXYidIAfWDO/p0QxpkcCfBMShlsOV1TwfZr6yIAnrMRt+vyiYuY3fO1dO51e8UBdT254ANZctzD+ODqHqagZ2Axk3np6A09mXIimhRiIzrZbDCoPYT72TLHBkgpLrDKHqsgLTNbesYosQHrvv4XqY/H3/gKzQt+fuesvHVhX4nwJJXESxxPlbuy5wE+TcQcZhdIlokUHqvHAKTUR7VXd9jlUS9TY/cqPAauBurzm1k4vM55r2MMPCB3H5ZXOBvWhvYkgo+uOqt3zfnF63tkUbA4C8SWqxFaCXZa1JZMtRl4APf1dyUBuvvMXeC36bjtGOWYQuVTIj3JUh0o4N4EIt2aapSOxD5q74UvMbTWCZEf8BhR0YxZeAyElk3485The5fqBkKcF8p3Nod1xyZNTtb7FyLFIV2i9C7GVe+ICz348cXLi7DHAz7/3DUUCvfkSoOjbqMh1KgsabP1v871Ko0OAd53L5N8aUnjGhA2qSHYiC01AbvefarzjyM4ZGCRd9+qPFlBJ5bOCZIVprrQ2GGmoTbYSznNKldbfFBhWQlCTWJky8XfWgNieal+jJzcFMbllB6NiipSY+qHXnXHXNXZXCBrT3seK6ImAqSU8QrgGQyJ6V4iwISj7pH5ucVoaspZdHRp6N5rRsO0eOjH03ZgBqu1tG3dIfvGyXTSiMx3qJhZZcE+BfeA==
    MB_ENCRYPTION_SECRET_KEY: >-
      AgCoPqZyamRvrGe4r5bIjsKYkSjNP+9Cg22H6zYuah5HzFOTy5iOts9gh6tfMbS5zmtXFw/cmGHvBkCXJxxu8KBCF5tZzwX4ofAEb/aymkUDR7aQ0weV3o03C425/FwqYiukJqgvyRBxoOOVHMi2+0h4cjMbrSqCNXGl5o1X6ah/GarqwRIuRXK0J6ko82L64jyXhE9GaLKG88cgbvYLYZOHMpP0vaZ3r111ZVBXA4z0PHFuKrhafhFGBmbDTnYKdSkNTEFJgwwuKk1kk8ZYzhyKrDEbQz7jVUZ+WJmGsWbLsv5HkGlpg0232RWEW4A/MSPMfZ8xI9eGo6J4SMgCxoh+JsZd1RV9EXKpEvUKEc1JnP1KundYda3MB6xI/wXEogqnFslfZ+6EjIqbZKlNOPtwqpavUhJ4E9PAc9JJUstjfwh3vA0IGDVh3+HLchfZhY+f0RFBf/25A5+TnXr04dWx8WfZU+F+kq3NrxCX+igs6ElB1QeA4S4YHK9WXaLRbev6rWtP09fsTnMdUHkfONu0cKZsGQLnLQ2+kn9T2UCuOnGNHw9dA1BxTCr05cR8EhJERlLYYEm1+yDz649iSj/+tj7deNqC/kExYPCdYNJ8eKKBk7wyilys/hgIrqLqK0pLHeuasoTAInZJBg17fgDhRhM0YN0H/CZtj4XWJJb45+n8lsDnkAHzT4vQ84NipUHaNF86RADRhH8WcMlx92XFQCPpGu9ftGt4+Xjt8syq3dCpvP1eJfVX
  template:
    metadata:
      annotations:
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        kapp.k14s.io/delete-strategy: orphan
        app.gitlab.com/app: socialgouv-mano
        app.gitlab.com/env: prod
        app.gitlab.com/env.name: prod
      name: metabase-db-user
      labels:
        application: mano
        component: mano
        owner: mano
        team: mano
    type: Opaque
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: metabase-configmap
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    application: mano
    component: mano
    owner: mano
    team: mano
  namespace: mano
data:
  MB_DB_TYPE: postgres
  MB_ADMIN_EMAIL: admin@fabrique.social.gouv.fr
  MB_ANON_TRACKING_ENABLED: 'false'
  MB_APPLICATION_LOGO_URL: https://socialgouv.github.io/support/_media/marianne.jpeg
  MB_APPLICATION_NAME: metabase-mano
  MB_EMAIL_FROM_ADDRESS: admin@fabrique.social.gouv.fr
  MB_ENABLE_EMBEDDING: 'true'
  MB_ENABLE_PUBLIC_SHARING: 'true'
  MB_SITE_LOCALE: fr
  MB_SITE_NAME: Fabrique des ministères sociaux
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: metabase
    application: mano
    component: mano
    owner: mano
    team: mano
  name: metabase
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  namespace: mano
spec:
  ports:
    - name: http
      port: 80
      targetPort: 3000
  selector:
    app: metabase
  type: ClusterIP
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth2-proxy-configmap
  namespace: mano
data:
  OAUTH2_PROXY_PROVIDER: github
  OAUTH2_PROXY_GITHUB_ORG: SocialGouv
  OAUTH2_PROXY_BANNER: Mano private access
  OAUTH2_PROXY_FOOTER: SocialGouv auth
  OAUTH2_PROXY_EMAIL_DOMAINS: '*'
  OAUTH2_PROXY_COOKIE_SECURE: 'false'
  OAUTH2_PROXY_CUSTOM_SIGN_IN_LOGO: https://socialgouv.github.io/support/_media/marianne.jpeg
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  annotations: {}
  name: oauth2-proxy-sealed-secret
  namespace: mano
spec:
  encryptedData:
    OAUTH2_PROXY_CLIENT_ID: >-
      AgANOMDdQvJfrKA2no7U1ijjIuPoP+NLsfag7zwjSGCVESezBx7llA8AQzXVBNfjraNhaeEFOCKqRl571JwHazx7zZaIwgamdvCOqNtTzLR+facBYjc3cMoBWQmWDQ39+JJZ+uCFt6SubRjkxMM5TsVf+KzVPlSbUi1pDaE2//q+vi4krgbSOgXD4KVcvWxkNDFLrBcqD360KddEY8kbBFiMBnimkbhb2RzJOHv+Dl55ZyOlkUcE/JU1z6Mu89jyvPKgMf9BXdXlaUcDV+8yWGPa/OD2iI9mkTgjqo3WLCv/AVAYdxXvlXBvXg1A1woetIS9TzEXt8X/hjANu2nwdCc5Lr8N3P6bRISFiQFbt/Qkbv0r5NmoYzvr81DBAxW4diwTp5g9aBLlsTwrQFZwDRYc3gSNGxDiGSvXPGaTyQ5FHkaE2DYEBxoXazNLtjItHusd9tpg4LLNQjqZBnUw4DBVbnR8WjxwDxQs8u1H5AIsYaiiFPrlOao9G4s8rRibl8manSzBP2HX2HK1AS4yMMP9cuzexxWUvr3j1Md295KBIuSRwGsMOR1vnkS83QYl4Bd6xgYmsGjqqI5+xGV5915uXmcjSHoj/NRriCX5tRVW+qlvcSSwha8CYUB1klsr+8sB0IEdskgkRlZOGMJqz+yi1Obl041DB3JpHE/qecDqyn+3kZqdFI4FOyczkZYVLoZaOdo/EeOZ1WG59zaokNIhqDvmbg==
    OAUTH2_PROXY_CLIENT_SECRET: >-
      AgByKQ6anRrt3JKe5HO/pxVcO4jB0lrhPYw44rcmHajN+qV4oKWOx6cGsAudcYXNkXrP+8XgmvCHoYwszrgX4v7AsvJ9/H1/G+SMyc2pi9zhDRApPAnxRc72+BfYpl78n+/xV9BneJj4zM5TH0prJQQqMHW+5aZCwjVqMKE50Iy2feKqe9iL6/GYCv63Q/eDmAzgKK6r0PubmQ1vOhbwv3+2NnOEGhvHwf7yO3RWTSI6BrSvhwiVdt2JHVd8UcQnuHXwT4+FZ2bVeL9EI33SwugEavAohlGQ7Xu916gpb5KfOtdb7Iay6rf9yuvtB87wvv9nBe4SGBLjNkGifTd7Awxr+TPEc+q8tDFCyyD29KcupEtZpkjg/Vw+FelZl7g8ZC1fvVsMqIfF0IQAUN6JZ570+icDwamW5VZv12va1MGlK7B84vqLrb+5MytnbP0A8bdurzuwTMRIs9Gb3vJKy2moPMk9VOLUu0vTW2ea+bRqi+D+6EzeCl9JJgomyUijIdo+Ye2z4X1UriKezixSTXXVA29nzsA8FFVfSyuXH4t34EUadYiA8QruatD17V5VUZQ7mM0h/TB+wzV0cwO35JT+f9CalnNaKsv6hhz18WFJ028WaVFl64BeWBwkZTCCtffxBOTIxBCJme1iUexgAqEs9X9L80XtGJFPBYxQeBRE21KT9l6hL/q6Ec79CBieuh8Ww/wLaU/mcvMZXozJg5xoH3J0UzcFNPdJoRMEtVM8BqkZAeY4Z3m+
    OAUTH2_PROXY_COOKIE_SECRET: >-
      AgCfdVYd/KRva4Gd1gHN+YSpUTfbbbo0joE/XUQPcfX2OJ5qzCSOXeeo7hPmtJzpfiAwnKUd8O7CH3i/I37KX+3wxfS2uWElVDjF6tyc2+pUWScq1CqootwgZQRSY3Ihy/W44/QvGYQSP6AJpeWM2fNSPWQKe1mgO/rID6FKJsj7XtmslTg/1M6dHkLONWZIxVrobZlldF2Ydx9SyhzYmUsEeDPZ4KG3uf7uuTjNMhc27hVVQXP5csyvK6GaVOvjk8HgbaP7/WxXaIWZ5FUwnh2Zm9BrhxrOyEKwreEjCx12dn2wymTqo6P4PLHvqNZIplSmAMUY2NF0OznfTkuSqNzfy7H+L7eA0geAlzPFW9+zvNIsIgInkipKV7fb6tRc21R+q2cAChAStQ+1PkWrT+KOwtVxmzjOXnDkNkkTNGTL7QtTEKgbPz0nU+PhofkjUYv3b/YT8dXrxQ2X9IycOd3CCWtXYhxk4yrALWLkHzWzTVe1NiQe3sgWFO4cc4Bjcq8d/jJLdYujThTuEqNYjFL/6WKmu4BmeuLlUlD8tLeYiUq9Df1e6Jft+Gcd4cblohlc6eU1I3EwCCBfIrgldhq7lvuEmIZ4NNU75HdO2QYc5Cn1koGiZuCsh71as8LaDk/Ek/tsOy1gUDeyLMdkmtEBr3I7v2yD94mNdyDoAaDGcJLPyyp3cD6x/eer2udakDA6XfROEv0vp4M42YHfCbaUfoKxGW59GQ4Lii2dCZGYWg==
  template:
    metadata:
      annotations: {}
      name: oauth2-proxy-sealed-secret
    type: Opaque
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    app: oauth2-proxy
    application: mano
    component: mano
    owner: mano
    team: mano
  name: oauth2-proxy
  namespace: mano
spec:
  replicas: 1
  selector:
    matchLabels:
      app: oauth2-proxy
  template:
    metadata:
      annotations:
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        kapp.k14s.io/delete-strategy: orphan
        app.gitlab.com/app: socialgouv-mano
        app.gitlab.com/env: prod
        app.gitlab.com/env.name: prod
      labels:
        app: oauth2-proxy
        application: mano
        component: mano
        owner: mano
        team: mano
    spec:
      containers:
        - image: quay.io/oauth2-proxy/oauth2-proxy:v7.2.1
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /ping
              port: http
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 5
          name: oauth2-proxy
          ports:
            - containerPort: 4180
              name: http
          readinessProbe:
            failureThreshold: 15
            httpGet:
              path: /ping
              port: http
            initialDelaySeconds: 0
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              cpu: 500m
              memory: 128Mi
            requests:
              cpu: 5m
              memory: 16Mi
          startupProbe:
            failureThreshold: 12
            httpGet:
              path: /ping
              port: http
            periodSeconds: 5
          envFrom:
            - configMapRef:
                name: oauth2-proxy-configmap
            - secretRef:
                name: oauth2-proxy-sealed-secret
          args:
            - '--upstream'
            - http://metabase:80
          env:
            - name: OAUTH2_PROXY_HTTP_ADDRESS
              value: 0.0.0.0:4180
            - name: OAUTH2_PROXY_REDIRECT_URL
              value: https://metabase-mano.fabrique.social.gouv.fr/oauth2/callback
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: oauth2-proxy
    application: mano
    component: mano
    owner: mano
    team: mano
  name: oauth2-proxy
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  namespace: mano
spec:
  ports:
    - name: http
      port: 80
      targetPort: 4180
  selector:
    app: oauth2-proxy
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: 'true'
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    app: oauth2-proxy
    application: mano
    component: mano
    owner: mano
    team: mano
  name: oauth2-proxy
  namespace: mano
spec:
  rules:
    - host: metabase-mano.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              service:
                name: oauth2-proxy
                port:
                  name: http
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - metabase-mano.fabrique.social.gouv.fr
      secretName: oauth2-proxy-crt
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: netpol-mano
  namespace: mano
spec:
  ingress:
    - from:
        - podSelector: {}
    - from:
        - namespaceSelector:
            matchLabels:
              network-policy/source: ingress-controller
    - from:
        - namespaceSelector:
            matchLabels:
              network-policy/source: monitoring
  podSelector: {}
  policyTypes:
    - Ingress
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    app: www
    application: mano
    component: nginx
    owner: mano
    team: mano
  name: www
  namespace: mano
spec:
  replicas: 1
  selector:
    matchLabels:
      app: www
  template:
    metadata:
      annotations:
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        kapp.k14s.io/delete-strategy: orphan
        app.gitlab.com/app: socialgouv-mano
        app.gitlab.com/env: prod
        app.gitlab.com/env.name: prod
      labels:
        app: www
        application: mano
        component: nginx
        owner: mano
        team: mano
    spec:
      containers:
        - image: ghcr.io/socialgouv/mano/website:sha-undefined
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /index.html
              port: http
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 5
          name: www
          ports:
            - containerPort: 80
              name: http
          readinessProbe:
            failureThreshold: 15
            httpGet:
              path: /index.html
              port: http
            initialDelaySeconds: 0
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              cpu: 500m
              memory: 128Mi
            requests:
              cpu: 5m
              memory: 32Mi
          startupProbe:
            failureThreshold: 12
            httpGet:
              path: /index.html
              port: http
            periodSeconds: 5
      imagePullSecrets:
        - name: regcred
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: www
    application: mano
    component: nginx
    owner: mano
    team: mano
  name: www
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  namespace: mano
spec:
  ports:
    - name: http
      port: 80
      targetPort: 80
  selector:
    app: www
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: 'true'
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    kapp.k14s.io/delete-strategy: orphan
    app.gitlab.com/app: socialgouv-mano
    app.gitlab.com/env: prod
    app.gitlab.com/env.name: prod
  labels:
    app: www
    application: mano
    component: nginx
    owner: mano
    team: mano
  name: www
  namespace: mano
spec:
  rules:
    - host: mano-app.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              service:
                name: www
                port:
                  name: http
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - mano-app.fabrique.social.gouv.fr
      secretName: www-crt
"
`;
